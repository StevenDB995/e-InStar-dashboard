<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Production Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            font-family: Poppins;
        }

        .container-root {
            height: 100%;
        }

        #container-left {
            padding: 0;
            background: #064da5;
        }

        #container-right {
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        #container-main {
            flex: 1 0 auto;
            background: #d8d9d4;
        }

        #navbar-left .nav-link {
            color: white;
        }

        .active {
            background: #033a7d;
            font-weight: bold;
        }

        #navbar-top {
            background: #064da5;
            padding: 12px;
        }

        #logo-container {
            text-align: center;
            padding: 10px 0;
        }

        #logo {
            width: 80px;
        }

        #display-area {
            margin: 20px 0;
            text-align: center;
            border-style: solid;
            border-color: #6f6f6f;
            border-width: 3px;
            border-radius: 20px;
            background: #eee;
            padding: 20px;
        }

        #heading {
            text-align: left;
        }

        #completion-rate {
            height: 200px; /* specifying the height of the dom is necessary for the floating effect  */
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        #completion-rate-graph {
            align-self: center;
        }

        #completion-rate-caption {
            padding-top: 10px;
            font-family: Pixer-Regular;
        }

        #completion-rate-number {
            padding-top: 10px;
            font-family: Pixer-Regular;
            font-size: 100px;
            background: linear-gradient(#25d7bc 30%, #ddd 50%, #25d7bc 70%);
            background-position-y: 60px;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine-completion-rate-number 5s cubic-bezier(0.4, 0, 0, 1) infinite,
            float-completion-rate-number 3s ease-in-out infinite alternate;
        }

        @keyframes shine-completion-rate-number {
            0% {
                background-position-y: 80px;
            }
            80%, 100% {
                background-position-y: -80px;
            }
        }

        @keyframes float-completion-rate-number {
            0% {
                padding-top: 10px;
            }
            100% {
                padding-top: 0;
            }
        }

        .box-icon-frame {
            display: inline-block;
            width: 20px;
            text-align: left;
        }

        .box-icon {
            width: 18px;
            height: 18px;
            object-fit: cover;
            object-position: 0 0;
        }

        @keyframes show-from-left {
            from {
                width: 0;
            }
            to {
                width: 18px;
            }
        }

        .box-icon.filled {
            animation: 1s ease-in 0s 1 show-from-left;
        }

        #monthly-completion {
            height: 360px;
        }

        #pass-rate {
            display: grid;
            grid-template-columns: 1fr 1fr;
            font-family: Pixer-Regular;
        }

        #pass, #fail {
            margin-top: 10px;
            margin-bottom: 10px;
            border-style: solid;
            border-width: 2px;
            border-radius: 10px;
            padding-top: 12px;
            box-shadow: 4px 4px 4px gray;
        }

        #pass {
            margin-left: 10%;
            margin-right: 5%;
            border-color: green;
            color: green;
            background: linear-gradient(315deg, transparent 35%, white 50%, transparent 65%) no-repeat;
            background-position-x: -320px;
            animation: shine-pass 5s ease-in-out infinite;
        }

        @keyframes shine-pass {
            0% {
                background-position-x: -320px;
            }
            50%, 100% {
                background-position-x: 320px;
            }
        }

        #fail {
            margin-left: 5%;
            margin-right: 10%;
            border-color: red;
            color: red;
            animation: glow-fail 2s ease-in-out infinite alternate;
            box-shadow: 4px 4px 4px gray, inset 0 0 20px red;
        }

        @keyframes glow-fail {
            0% {
                text-shadow: none;
            }
            100% {
                text-shadow: 0 0 10px red;
            }
        }

        #pass div:nth-child(1), #fail div:nth-child(1) {
            font-size: 24px;
        }

        #pass-number, #fail-number {
            font-size: 60px;
        }

        #monthly-pass-rate {
            margin: 40px 0;
        }

        .progress-bar-row {
            display: flex;
        }

        .progress {
            width: 80%;
            margin: 10px 0;
            background: #ffc107;
        }

        .progress-bar-left {
            width: 10%;
            align-self: center;
            margin-right: 10px;
        }

        .progress-bar-right {
            width: 10%;
            align-self: center;
            margin-left: 10px;
        }

        @font-face {
            font-family: Poppins;
            src: url(/fonts/poppins-v15-latin-regular.woff);
        }

        @font-face {
            font-family: Pixer-Regular;
            src: url(/fonts/Pixer-Regular.woff);
        }
    </style>
</head>
<body>
<div class="container-fluid container-root">
    <div class="row container-root">
        <div id="container-left" class="col-2"><!--TODO: responsive-->
            <div id="logo-container">
                <img th:src="@{/images/grey_logo.png}" alt="logo" id="logo"/>
            </div>
            <nav id="navbar-left" class="nav flex-column">
                <a class="nav-link active" href="#"><i class="fas fa-analytics"></i>&nbsp;&nbsp;Production</a>
                <a class="nav-link" href="#"><i class="fas fa-truck-moving"></i>&nbsp;&nbsp;Logistics</a>
                <a class="nav-link" href="#"><i class="fas fa-city"></i>&nbsp;&nbsp;Installation</a>
            </nav>
        </div>
        <div id="container-right" class="col"><!--TODO: responsive-->
            <div id="navbar-top">Top Navigation Bar</div>
            <div id="container-main">
                <!--main content of the dashboard-->
                <div class="row" style="margin: 0"><!--add a style here to fix a bug caused by bootstrap row-->
                    <div class="col-3"></div>
                    <div class="col-6" id="display-area"><!--TODO: responsive-->
                        <div id="heading">
                            <h3>PRODUCTION</h3>
                        </div>
                        <div id="completion-rate">
                            <div id="completion-rate-graph">
                                <div th:each="i : ${#numbers.sequence(0,4)}">
                                    <div th:each="j : ${#numbers.sequence(0,9)}" class="box-icon-frame">
                                        <img th:id="'box-icon-' + ${i*10 + j}" th:src="@{/images/box-0.png}" class="box-icon" />
                                    </div>
                                </div>
                                <div id="completion-rate-caption">
                                    <span id="completed-modules"></span> of <span id="total-modules"></span> modules completed
                                </div>
                            </div>
                            <div id="completion-rate-number">
                                <span></span>%
                            </div>
                        </div>
                        <div id="monthly-completion"></div>
                        <div id="pass-rate">
                            <div id="pass">
                                <div>PASS</div>
                                <div id="pass-number">
                                    <span></span>%
                                </div>
                            </div>
                            <div id="fail">
                                <div>FAIL</div>
                                <div id="fail-number">
                                    <span></span>%
                                </div>
                            </div>
                        </div>
                        <div id="monthly-pass-rate">
                            <div class="progress-bar-row">
                                <div class="progress-bar-left">DEC</div>
                                <div class="progress">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: 0" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div class="progress-bar-right">70%</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-3"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script th:src="@{/js/echarts.min.js}"></script>
<script th:inline="javascript">
    /**
     * -----------------------------------------------------------------------------------------------------------------
     * block: completion rate
     */
    var completedModules = 532; // to be passed via model map from backend
    var totalModules = 952; // to be passed via model map from backend
    var completionRate = completedModules / totalModules;

    for (let i = 0; i < completionRate * 50; ++i) {
        $('#box-icon-' + i).attr('src', '/images/box-1.png');
        $('#box-icon-' + i).addClass('filled');
    }

    $('#completed-modules').text(completedModules);
    $('#total-modules').text(totalModules);

    animateNumberDisplay($('#completion-rate-number span'), completionRate * 100, 1000, 1);

    /**
     * -----------------------------------------------------------------------------------------------------------------
     * block: monthly completion
     */
    var monthlyCompletionChart = echarts.init(document.getElementById('monthly-completion'));
    monthlyCompletionChart.setOption({
        grid: {
            left: '15%'
        },
        xAxis: {
            type: 'category',
            boundaryGap: false,
            data: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
        },
        yAxis: {
            type: 'value',
            name: 'No. of Modules',
            nameLocation: 'middle',
            nameGap: 50,
            nameTextStyle: {
                fontStyle: 'bold',
                fontSize: 14,
                color: '#000'
            }
        },
        legend: {
            orient: 'vertical',
            right: '10%',
            bottom: '27%',
            padding: 10,
            backgroundColor: '#fff',
            borderColor: '#999',
            borderWidth: 2,
            borderRadius: 5,
            data: ['Planned', 'Actual']
        },
        tooltip: {
            trigger: 'axis'
        },
        series: [
            {
                type: 'line',
                name: 'Planned',
                data: [1000, 1050, 1130, 1200, 1350, 1500, 1550, 1550, 1550, 1550, 1550, 1550], // to be passed via model map from backend
                smooth: true,
                lineStyle: {
                    color: '#25d7bc',
                    width: 3
                },
                itemStyle: {
                    color: '#25d7bc'
                }
            },
            {
                type: 'line',
                name: 'Actual',
                data: [820, 932, 901, 934, 1290, 1330, 1320, 1440, 1508, 1601, 1599, 1604], // to be passed via model map from backend
                smooth: true,
                lineStyle: {
                    color: '#ee819a',
                    width: 3
                },
                itemStyle: {
                    color: '#ee819a'
                }
            }
        ]
    });

    new ResizeObserver(function () {
        monthlyCompletionChart.resize();
    }).observe(document.getElementById('container-right'));

    /**
     * -----------------------------------------------------------------------------------------------------------------
     * block: pass rate
     */
    var passRate = 0.9; // to be passed via model map from backend
    var failRate = 1.0 - passRate;
    animateNumberDisplay($('#pass-number span'), passRate * 100, 1000, 0);
    animateNumberDisplay($('#fail-number span'), failRate * 100, 1000, 0);

    /**
     * display number with animation in a counting manner
     * @param $element the jquery element holding the number
     * @param number the number to be animated
     * @param duration duration of the animation
     * @param fractionDigits number of decimals to be rounded to
     */
    function animateNumberDisplay($element, number, duration, fractionDigits) {
        $element.text(number);
        $element.prop('counter', 0).animate({ // start counting from 0
            counter: $element.text()
        }, {
            duration: duration,
            easing: 'swing',
            step: function (current) {
                $element.text(current.toFixed(fractionDigits));
            }
        });
    }

    $('.progress-bar').attr('aria-valuenow', 70).animate({
        width: '70%'
    }, {
        duration: 1000
    });
</script>
</body>
</html>